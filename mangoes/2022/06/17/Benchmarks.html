<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Wrapping up Linear Models | Mangoes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Wrapping up Linear Models" />
<meta name="author" content="Huon Fraser" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Part 5 of the mangoes_blog project" />
<meta property="og:description" content="Part 5 of the mangoes_blog project" />
<link rel="canonical" href="https://huonfraser.github.io/Mangoes/mangoes/2022/06/17/Benchmarks.html" />
<meta property="og:url" content="https://huonfraser.github.io/Mangoes/mangoes/2022/06/17/Benchmarks.html" />
<meta property="og:site_name" content="Mangoes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-17T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Wrapping up Linear Models" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Huon Fraser"},"dateModified":"2022-06-17T00:00:00-05:00","datePublished":"2022-06-17T00:00:00-05:00","description":"Part 5 of the mangoes_blog project","headline":"Wrapping up Linear Models","mainEntityOfPage":{"@type":"WebPage","@id":"https://huonfraser.github.io/Mangoes/mangoes/2022/06/17/Benchmarks.html"},"url":"https://huonfraser.github.io/Mangoes/mangoes/2022/06/17/Benchmarks.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/Mangoes/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://huonfraser.github.io/Mangoes/feed.xml" title="Mangoes" /><link rel="shortcut icon" type="image/x-icon" href="/Mangoes/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/Mangoes/">Mangoes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/Mangoes/about/">About Me</a><a class="page-link" href="/Mangoes/search/">Search</a><a class="page-link" href="/Mangoes/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Wrapping up Linear Models</h1><p class="page-description">Part 5 of the mangoes_blog project</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-06-17T00:00:00-05:00" itemprop="datePublished">
        Jun 17, 2022
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Huon Fraser</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/Mangoes/categories/#mangoes">mangoes</a>
        
      
      </p>
    

    
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Ensemble-methods">Ensemble methods </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Random-Forest">Random Forest </a></li>
<li class="toc-entry toc-h3"><a href="#Scikit-learn-Gradient-Boosting">Scikit-learn Gradient Boosting </a></li>
<li class="toc-entry toc-h3"><a href="#XGBoost">XGBoost </a></li>
<li class="toc-entry toc-h3"><a href="#Ensembles-of--PLS-LWR">Ensembles of  PLS-LWR </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Comparing-Techniques">Comparing Techniques </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-06-17-Benchmarks.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'/notebooks/Mangoes/src/'</span><span class="p">)</span>
<span class="n">model_path</span>  <span class="o">=</span> <span class="s1">'../models/'</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">codetiming</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GroupKFold</span>
<span class="kn">from</span> <span class="nn">scikit_models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Real</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">lwr</span> <span class="kn">import</span> <span class="n">LocalWeightedRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
File <span class="ansi-green-fg">__init__.pxd:942</span>, in <span class="ansi-cyan-fg">numpy.import_array</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">RuntimeError</span>: module compiled against API version 0x10 but this version of numpy is 0xf

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">ImportError</span>                               Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/conda/lib/python3.10/site-packages/pandas/__init__.py:30</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     29</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">---&gt; 30</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pandas</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">_libs</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> hashtable <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> _hashtable, lib <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> _lib, tslib <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> _tslib
<span class="ansi-green-intense-fg ansi-bold">     31</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ImportError</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:  <span style="color: rgb(95,135,135)"># pragma: no cover</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span>     <span style="color: rgb(95,135,135)"># hack but overkill to use re</span>

File <span class="ansi-green-fg">/opt/conda/lib/python3.10/site-packages/pandas/_libs/__init__.py:13</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> __all__ <span style="color: rgb(98,98,98)">=</span> [
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">NaT</span><span style="color: rgb(175,0,0)">"</span>,
<span class="ansi-green-intense-fg ansi-bold">      3</span>     <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">NaTType</span><span style="color: rgb(175,0,0)">"</span>,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>     <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">Interval</span><span style="color: rgb(175,0,0)">"</span>,
<span class="ansi-green-intense-fg ansi-bold">     10</span> ]
<span class="ansi-green-fg">---&gt; 13</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pandas</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">_libs</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">interval</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> Interval
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pandas</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">_libs</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">tslibs</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> (
<span class="ansi-green-intense-fg ansi-bold">     15</span>     NaT,
<span class="ansi-green-intense-fg ansi-bold">     16</span>     NaTType,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">     21</span>     iNaT,
<span class="ansi-green-intense-fg ansi-bold">     22</span> )

File <span class="ansi-green-fg">pandas/_libs/interval.pyx:1</span>, in <span class="ansi-cyan-fg">init pandas._libs.interval</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/hashtable.pyx:1</span>, in <span class="ansi-cyan-fg">init pandas._libs.hashtable</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/missing.pyx:1</span>, in <span class="ansi-cyan-fg">init pandas._libs.missing</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">/opt/conda/lib/python3.10/site-packages/pandas/_libs/tslibs/__init__.py:30</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     29</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">.</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> dtypes
<span class="ansi-green-fg">---&gt; 30</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">conversion</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> OutOfBoundsTimedelta, localize_pydatetime
<span class="ansi-green-intense-fg ansi-bold">     31</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">dtypes</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> Resolution

File <span class="ansi-green-fg">pandas/_libs/tslibs/conversion.pyx:1</span>, in <span class="ansi-cyan-fg">init pandas._libs.tslibs.conversion</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">pandas/_libs/tslibs/nattype.pyx:27</span>, in <span class="ansi-cyan-fg">init pandas._libs.tslibs.nattype</span><span class="ansi-blue-fg">()</span>

File <span class="ansi-green-fg">__init__.pxd:944</span>, in <span class="ansi-cyan-fg">numpy.import_array</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">ImportError</span>: numpy.core.multiarray failed to import

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">ImportError</span>                               Traceback (most recent call last)
Input <span class="ansi-green-fg">In [1]</span>, in <span class="ansi-cyan-fg">&lt;cell line: 3&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)">#collapse-hide</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pathlib</span>
<span class="ansi-green-fg">----&gt; 3</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pandas</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pd</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">numpy</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> <span class="ansi-bold" style="color: rgb(0,0,255)">np</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">sys</span>

File <span class="ansi-green-fg">/opt/conda/lib/python3.10/site-packages/pandas/__init__.py:34</span>, in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     31</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ImportError</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> e:  <span style="color: rgb(95,135,135)"># pragma: no cover</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span>     <span style="color: rgb(95,135,135)"># hack but overkill to use re</span>
<span class="ansi-green-intense-fg ansi-bold">     33</span>     module <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">str</span>(e)<span style="color: rgb(98,98,98)">.</span>replace(<span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">cannot import name </span><span style="color: rgb(175,0,0)">"</span>, <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">"</span>)
<span class="ansi-green-fg">---&gt; 34</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ImportError</span>(
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span style="color: rgb(175,0,0)">f</span><span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">C extension: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>module<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span style="color: rgb(175,0,0)"> not built. If you want to import </span><span style="color: rgb(175,0,0)">"</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>         <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">pandas from the source directory, you may need to run </span><span style="color: rgb(175,0,0)">"</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>         <span style="color: rgb(175,0,0)">"</span><span style="color: rgb(175,0,0)">'</span><span style="color: rgb(175,0,0)">python setup.py build_ext --inplace --force</span><span style="color: rgb(175,0,0)">'</span><span style="color: rgb(175,0,0)"> to build the C extensions first.</span><span style="color: rgb(175,0,0)">"</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>     ) <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">e</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span> <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">pandas</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">_config</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> (
<span class="ansi-green-intense-fg ansi-bold">     41</span>     get_option,
<span class="ansi-green-intense-fg ansi-bold">     42</span>     set_option,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>     options,
<span class="ansi-green-intense-fg ansi-bold">     47</span> )
<span class="ansi-green-intense-fg ansi-bold">     49</span> <span style="color: rgb(95,135,135)"># let init-time option registration happen</span>

<span class="ansi-red-fg">ImportError</span>: C extension: numpy.core.multiarray failed to import not built. If you want to import pandas from the source directory, you may need to run 'python setup.py build_ext --inplace --force' to build the C extensions first.</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mangoes</span><span class="o">=</span><span class="n">load_mangoes</span><span class="p">()</span>

<span class="n">train_data</span><span class="p">,</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">mangoes</span><span class="p">)</span>
<span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">train_cat</span> <span class="o">=</span> <span class="n">X_y_cat</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span><span class="n">min_X</span><span class="o">=</span><span class="mi">684</span><span class="p">,</span><span class="n">max_X</span><span class="o">=</span><span class="mi">990</span><span class="p">)</span>
<span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">test_cat</span> <span class="o">=</span> <span class="n">X_y_cat</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span><span class="n">min_X</span><span class="o">=</span><span class="mi">684</span><span class="p">,</span><span class="n">max_X</span><span class="o">=</span><span class="mi">990</span><span class="p">)</span>
<span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">train_X</span><span class="o">.</span><span class="n">shape</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">train_cat</span><span class="p">[</span><span class="s1">'Pop'</span><span class="p">]</span>
<span class="n">splitter</span><span class="o">=</span><span class="n">GroupKFold</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Ensemble-methods">
<a class="anchor" href="#Ensemble-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ensemble methods<a class="anchor-link" href="#Ensemble-methods"> </a>
</h2>
<p>We now compare our approach to off the shelf ensemble models that are typically the state of the art for tabular problems. We train off-the-shelf variants of <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">Random Forest</a>, the default sklearn <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingRegressor.html#sklearn.ensemble.GradientBoostingRegressor">Gradient Boosting Regression</a> and <a href="https://xgboost.readthedocs.io/en/stable/">XGBoost</a>. A caveat here is that each of these models could probably be optimised further. Intitial performance with standaridisation preprocessing was dissapointing so we used PLS preprocessing for these experiemnts.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-Forest">
<a class="anchor" href="#Random-Forest" aria-hidden="true"><span class="octicon octicon-link"></span></a>Random Forest<a class="anchor-link" href="#Random-Forest"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">'scaler'</span><span class="p">,</span> <span class="n">PLSRegression</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">'model'</span><span class="p">,</span><span class="n">RandomForestRegressor</span><span class="p">())</span>
    <span class="p">])</span>

<span class="n">space</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">'scaler__n_components'</span><span class="p">),</span>
         <span class="p">]</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">Optimiser</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
<span class="n">model_forest</span><span class="p">,</span><span class="n">result_forest</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">save_file</span><span class="o">=</span><span class="n">model_path</span><span class="o">+</span><span class="s1">'5_random_forest'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Scikit-learn-Gradient-Boosting">
<a class="anchor" href="#Scikit-learn-Gradient-Boosting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Scikit-learn Gradient Boosting<a class="anchor-link" href="#Scikit-learn-Gradient-Boosting"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">'scaler'</span><span class="p">,</span> <span class="n">PLSRegression</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">'model'</span><span class="p">,</span><span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="p">])</span>


<span class="n">space</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">'scaler__n_components'</span><span class="p">),</span>
         <span class="p">]</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">Optimiser</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
<span class="n">model_boost</span><span class="p">,</span><span class="n">result_boost</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">save_file</span><span class="o">=</span><span class="n">model_path</span><span class="o">+</span><span class="s1">'5_gradboost'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="XGBoost">
<a class="anchor" href="#XGBoost" aria-hidden="true"><span class="octicon octicon-link"></span></a>XGBoost<a class="anchor-link" href="#XGBoost"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">'scaler'</span><span class="p">,</span> <span class="n">PLSRegression</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">'model'</span><span class="p">,</span><span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">tree_method</span><span class="o">=</span><span class="s2">"gpu_hist"</span><span class="p">))</span>
    <span class="p">])</span>
<span class="n">space</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Integer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">'scaler__n_components'</span><span class="p">)</span>
        <span class="p">]</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">Optimiser</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
<span class="n">model_xg</span><span class="p">,</span> <span class="n">result_xg</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">save_file</span><span class="o">=</span><span class="n">model_path</span><span class="o">+</span><span class="s1">'5_xgboost'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Ensembles-of--PLS-LWR">
<a class="anchor" href="#Ensembles-of--PLS-LWR" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ensembles of  PLS-LWR<a class="anchor-link" href="#Ensembles-of--PLS-LWR"> </a>
</h3>
<p>We've left them until last because typically emsembles will always give better performance; any of the models looked at in the previous 3 parts could be ensmbled. We take our previous best model (SG-PLS-LWR) and build a <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.BaggingRegressor.html">bagging regressor</a> ensemble. This builds 10 copys of a model, with each trained on a sample (with replacement) of the dataset. Predictions are then made by taking the mean of the ensemble.</p>
<p>Results are no better than for the non-ensembled version. A possible explanation is that bagging reduces the density of the feature space, interfering with the locally weighted regressions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">BaggingRegressor</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span><span class="p">,</span> <span class="n">load</span>

<span class="n">pipe</span> <span class="o">=</span>  <span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="o">+</span><span class="s1">'4_pp-pls-lwr_model2.joblib'</span><span class="p">)</span> 
<span class="n">model</span> <span class="o">=</span> <span class="n">BaggingRegressor</span><span class="p">(</span><span class="n">pipe</span><span class="p">)</span>

<span class="n">mse</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">splitter</span><span class="o">=</span><span class="n">splitter</span><span class="p">,</span><span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Train set MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">train_X</span><span class="p">,</span><span class="n">train_y</span><span class="p">,</span><span class="n">test_X</span><span class="p">,</span><span class="n">test_y</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparing-Techniques">
<a class="anchor" href="#Comparing-Techniques" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparing Techniques<a class="anchor-link" href="#Comparing-Techniques"> </a>
</h2>
<p>So far in this series, we started with a multiple linear regression (LR) and dded complexity; feature extraction with partial least squares (PLS), lazy instance weights with locally weighted regressions (LWR) and preprocessing with Savitsky Golay (SG). Adding ach of these components incrementally improved performance during cross-validation, although the hyperparameter settings were not always consistent. The final model in this series (SG-PLS-LWR) gave a cross-validation MSE of 0.7223 and a test MSE of 0.7686.</p>
<p>When we compared this model to off-the-shelf ensembles (including XGBoost) and a bagging-ensemble extension, we found that these underperformed our model. To round out this part of the series we compare our results to the original Mangoes results achieved by Anderson et al.</p>
<p>In the table we below we compare two models by Anderson et al, LPLS, their best performing locally weighted PLS model, and Ensemble, their best ensemble based model to the models we have built in this series. Our approach gave substantially better results that both models.  Without going into too much detail, this is likely due to the Anderson et al. models fixing the number of components for PLS to a relatively low number, whereas we kept this hyperparmater flexible.</p>
<table>
<thead>
<tr>
<th>Model</th>
<th style="text-align:center">CV Score</th>
<th style="text-align:right">Test Score</th>
</tr>
</thead>
<tbody>
<tr>
<td>LR</td>
<td style="text-align:center">0.8157</td>
<td style="text-align:right">1.1147</td>
</tr>
<tr>
<td>PLS-LR</td>
<td style="text-align:center">0.8116</td>
<td style="text-align:right">-------</td>
</tr>
<tr>
<td>LWR</td>
<td style="text-align:center">0.7868</td>
<td style="text-align:right">-------</td>
</tr>
<tr>
<td>PLS-LWR</td>
<td style="text-align:center">0.7520</td>
<td style="text-align:right">0.8113</td>
</tr>
<tr>
<td>SG-PLS-LWR</td>
<td style="text-align:center">0.7223</td>
<td style="text-align:right">0.7686</td>
</tr>
<tr>
<td>E(SG-PLS-LWR)</td>
<td style="text-align:center">0.7236</td>
<td style="text-align:right">0.7801</td>
</tr>
<tr>
<td>Anderson et al. LPLS</td>
<td style="text-align:center">0.66</td>
<td style="text-align:right">0.887</td>
</tr>
<tr>
<td>Anderson et al. Ensemble</td>
<td style="text-align:center">0.56</td>
<td style="text-align:right">0.850</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/Mangoes/mangoes/2022/06/17/Benchmarks.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/Mangoes/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/Mangoes/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/Mangoes/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A datascience project for predicting dry matter content on the public domain Mangoes IR-spectroscopy dataset.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
